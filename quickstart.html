
<!DOCTYPE html>


<html lang="en" data-content_root="./" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Quick-start guide &#8212; VAMPIRES DPP</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="_static/styles/sphinx-book-theme.css?v=eba8b062" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="_static/documentation_options.js?v=22248820"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'quickstart';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Configuration" href="configuration.html" />
    <link rel="prev" title="Introduction" href="introduction.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="_static/scexao_logo.svg" class="logo__image only-light" alt="VAMPIRES DPP - Home"/>
    <script>document.write(`<img src="_static/scexao_logo.svg" class="logo__image only-dark" alt="VAMPIRES DPP - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/scexao-org/vampires_dpp" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
</ul></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Quick-start guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli.html">CLI Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">Frequently Asked Questions (FAQ)</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="api/index.html">API/Reference</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="api/organization.html">Organization</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/calibration.html">Calibration</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/analysis.html">Analysis</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/image_registration.html">Image Registration</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/image_processing.html">Image Processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/specphot.html">Spectrophotometric Calibration</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/polarization.html">Polarization</a></li>
<li class="toctree-l2"><a class="reference internal" href="api/utility.html">Utility</a></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">


<a href="https://github.com/scexao-org/vampires_dpp" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/quickstart.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Quick-start guide</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sorting-raw-data">Sorting raw data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#normalizing-data">Normalizing data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cmos-format">CMOS format</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#emccd-formats">EMCCD formats</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quick-look-and-filter">Quick look and filter</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-calibration-files">Create calibration files</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#set-up-configuration-files">Set up configuration files</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#prepare-image-centroids-estimates">Prepare image centroids estimates</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#automated-mode">Automated mode</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#manual-mode">Manual mode</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#running-the-pipeline">Running the pipeline</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#processing-steps">Processing steps</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#polarimetric-differential-imaging">Polarimetric differential imaging</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pipeline-outputs">Pipeline outputs</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#re-running-the-pipeline">Re-running the pipeline</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="quick-start-guide">
<h1>Quick-start guide<a class="headerlink" href="#quick-start-guide" title="Link to this heading">#</a></h1>
<p>We strive to make the VAMPIRES DPP as automated as possible- the following setup should get you 90% of the way towards successful data reduction, depending on the complexity of your dataset! We assume that you have already successfully installed the <code class="docutils literal notranslate"><span class="pre">vampires_dpp</span></code> package. If not, see <a class="reference internal" href="installation.html#installation"><span class="std std-ref">Installation</span></a>. For help with the command-line interface we recommend using the built-in docstrings (<code class="docutils literal notranslate"><span class="pre">-h</span></code>/<code class="docutils literal notranslate"><span class="pre">--help</span></code>) or the <a class="reference internal" href="cli.html#cli"><span class="std std-ref">documentation</span></a>.</p>
<nav class="contents local" id="contents">
<ul class="simple">
<li><p><a class="reference internal" href="#sorting-raw-data" id="id1">Sorting raw data</a></p></li>
<li><p><a class="reference internal" href="#normalizing-data" id="id2">Normalizing data</a></p></li>
<li><p><a class="reference internal" href="#quick-look-and-filter" id="id3">Quick look and filter</a></p></li>
<li><p><a class="reference internal" href="#create-calibration-files" id="id4">Create calibration files</a></p></li>
<li><p><a class="reference internal" href="#set-up-configuration-files" id="id5">Set up configuration files</a></p></li>
<li><p><a class="reference internal" href="#prepare-image-centroids-estimates" id="id6">Prepare image centroids estimates</a></p></li>
<li><p><a class="reference internal" href="#running-the-pipeline" id="id7">Running the pipeline</a></p></li>
<li><p><a class="reference internal" href="#re-running-the-pipeline" id="id8">Re-running the pipeline</a></p></li>
</ul>
</nav>
<div class="tip admonition">
<p class="admonition-title">Multi-processing</p>
<p>The pipeline uses Python multi-processing to help speed-up reductions. You will likely be limited by your computer’s available memory (RAM)- if you spawn too many processes and load too much data in parallel you can run out of memory. Commands with multi-processing enabled have the <code class="docutils literal notranslate"><span class="pre">-j</span></code> command line flag, which will default to a single process <code class="docutils literal notranslate"><span class="pre">-j1</span></code> by default.</p>
<p>When possible, we indicate a command that has multi-processing enabled with the “🚀” emoji. We do not multi-process by default (to avoid awkward out-of-memory errors) so you must <em>opt in</em> to all commands using the <code class="docutils literal notranslate"><span class="pre">-j</span></code> flag.</p>
<p>In general, multiprocessing does seem to help when not limited by file I/O (e.g., slow hard disk drive), so give it a try!</p>
</div>
<div class="tip admonition">
<p class="admonition-title">Tip: multiprocessing and numpy</p>
<p>Internal numpy routines can cause multiprocessing to become <em>much</em> slower. In this case, make sure to set the <a class="reference external" href="https://numpy.org/doc/stable/reference/global_state.html#number-of-threads-used-for-linear-algebra">appropriate environment variables</a>.</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>export OMP_NUM_THREADS=1
</pre></div>
</div>
</div>
<div class="warning admonition">
<p class="admonition-title">Warning: Large data volume</p>
<p>This pipeline tries to minimize the number of FITS files saved to disk due to the massive volume of VAMPIRES data. To accomplish this, we skip saving intermediate files when possible. Still, you should expect your data volume to increase by a factor of ~2.5. If saving intermediate products, this factor increases to ~6.5 times the raw data size. It is strongly recommended to work with a large attached storage.</p>
</div>
<section id="sorting-raw-data">
<h2><a class="toc-backref" href="#id1" role="doc-backlink">Sorting raw data</a><a class="headerlink" href="#sorting-raw-data" title="Link to this heading">#</a></h2>
<p>After downloading your data, you may want to sort it into subfolders based on the data type and object observed.</p>
<div class="admonition-pre-s23a-data-types admonition">
<p class="admonition-title">Pre-S23A Data types</p>
<p>Data types are not appropriately populated into headers for data taken before the S23A semester. For these data, we will try and parse a file type from the OG filename. In other words, if the VAMPIRES operator took data labeled “darks_*.fits”, we will put that into the darks folder. This automation is ad-hoc and should be verified by a human after sorting.</p>
</div>
<p>After downloading your data, you can run <code class="docutils literal notranslate"><span class="pre">dpp</span> <span class="pre">sort</span></code> to automatically sort your data into human-readable folders, ready for further processing.</p>
<aside class="margin sidebar">
<p class="sidebar-title">🚀 MP enabled</p>
<p>‎</p>
</aside>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dpp</span> <span class="n">sort</span> <span class="p">[</span><span class="o">-</span><span class="n">j</span> <span class="mi">1</span><span class="p">]</span> <span class="n">VMPA</span><span class="o">*.</span><span class="n">fits</span>
</pre></div>
</div>
<p>The prescribed folder structure for this sorting is</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>.
├── ABAUR
│   └── 750-50_em300_00100ms_512x512
├── HD31233
│   └── 750-50_em300_00100ms_512x512
├── darks
│   └── em300_00100ms_512x512
├── flats
│   └── 750-50_em300_00100ms_512x512
├── pinholes
│   └── 750-50_em300_00100ms_512x512
└── skies
    └── em300_00100ms_512x512
</pre></div>
</div>
<p>after sorting this folders can be changed or rearranged as much as you’d like. The configuration for the pipeline is flexible, so you don’t have to sort your files at all if you prefer a different method.</p>
</section>
<section id="normalizing-data">
<h2><a class="toc-backref" href="#id2" role="doc-backlink">Normalizing data</a><a class="headerlink" href="#normalizing-data" title="Link to this heading">#</a></h2>
<p>There are a few recognized data formats the processing pipeline recognizes. Depending on which data format you have, additional steps may need to be taken to normalize data to prepare it for the pipeline.</p>
<div class="admonition-which-data-needs-normalized admonition">
<p class="admonition-title">Which data needs normalized?</p>
<p>Any EMCCD VAMPIRES format data needs normalized- at minimum it will removed the corrupted detector readout frame and empty frames.</p>
</div>
<section id="cmos-format">
<h3>CMOS format<a class="headerlink" href="#cmos-format" title="Link to this heading">#</a></h3>
<p>Any data taken after the June 2023 upgrades has the same format regardless if data is downloaded from the archive or from the SCExAO computers directly. It is assumed that any FLC deinterleaving has been done beforehand, which is expected to be done by the support astronomer.</p>
<p>No further action is required for the CMOS format- <code class="docutils literal notranslate"><span class="pre">dpp</span> <span class="pre">norm</span></code> can be skipped.</p>
</section>
<section id="emccd-formats">
<h3>EMCCD formats<a class="headerlink" href="#emccd-formats" title="Link to this heading">#</a></h3>
<p>These formats are used for VAMPIRES data prior to the June 2023 upgrades. They come in two distinct formats</p>
<ol class="arabic simple">
<li><p>STARS archive format (<strong>default for open-use observers</strong>)</p>
<ul class="simple">
<li><p>Files are given frame id names or standardized archive names, e.g. “VMPA00023445.fits”</p></li>
<li><p>Each file corresponds to a single camera, FLC state, and HWP angle</p></li>
</ul>
</li>
<li><p>VAMPIRES format</p>
<ul class="simple">
<li><p>Files have names as set by controller, e.g. “HD141569A_00_750-50_LyotStop_00_cam1.fits”</p></li>
<li><p>Each file is a raw cube from the camera, which includes bad readout frame in the first frame</p></li>
<li><p>FLC states interleaved in every other frame for PDI mode</p></li>
</ul>
</li>
</ol>
<p>If your data is in the STARS format, <em>no further action is needed</em>- <code class="docutils literal notranslate"><span class="pre">dpp</span> <span class="pre">norm</span></code> can be skipped. If your data is in the VAMPIRES format, you’ll need to run <code class="docutils literal notranslate"><span class="pre">dpp</span> <span class="pre">norm</span></code> to run some essential pre-processing steps.</p>
<p>At minimum, you’ll need to discard the initial frames which have readout artifacts. If your data is polarimetric you will also need to deinterleave the files (add the <code class="docutils literal notranslate"><span class="pre">-d</span></code> flag). This process will also cut out any frames which are all zeros- a common occurrence when aborting exposure sequences before completion.</p>
<aside class="margin sidebar">
<p class="sidebar-title">🚀 MP enabled</p>
<p>‎</p>
</aside>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dpp</span> <span class="n">norm</span> <span class="p">[</span><span class="o">-</span><span class="n">j</span> <span class="mi">1</span><span class="p">]</span> <span class="p">[</span><span class="o">-</span><span class="n">d</span><span class="p">]</span> <span class="o">-</span><span class="n">o</span> <span class="n">normed</span> <span class="mi">750</span><span class="o">-</span><span class="mi">50</span><span class="n">_em300_00100ms_512x512</span><span class="o">/*.</span><span class="n">fits</span>
</pre></div>
</div>
<div class="admonition-which-data-needs-deinterleaved admonition">
<p class="admonition-title">Which data needs deinterleaved?</p>
<p>Not all data needs deinterleaved- calibration files (darks, flats, pinholes, skies, etc.) typically do not need deinterleaved. If you do not plan to do polarimetry (e.g., speckle imaging, ADI-only) you can skip deinterleaving entirely, effectively averaging together data between the two FLC states. If you prefer to model each state separately then deinterleave away.</p>
</div>
</section>
</section>
<section id="quick-look-and-filter">
<h2><a class="toc-backref" href="#id3" role="doc-backlink">Quick look and filter</a><a class="headerlink" href="#quick-look-and-filter" title="Link to this heading">#</a></h2>
<p>Before running files through the pipeline, it is recommended to inspect your raw data and discard errant cubes and cubes with poor seeing. Doing this ahead of time saves on processing time and avoids errors.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dpp</span> <span class="n">select</span> <span class="o">&lt;</span><span class="n">input_files</span><span class="o">&gt;/*.</span><span class="n">fits</span>
</pre></div>
</div>
<img alt="_images/dpp_select.mov" src="_images/dpp_select.mov" />
<p>After this, you can use the filelist as your input, for example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>dpp run my_config.toml $(&lt; filelist_select.txt)
</pre></div>
</div>
</section>
<section id="create-calibration-files">
<h2><a class="toc-backref" href="#id4" role="doc-backlink">Create calibration files</a><a class="headerlink" href="#create-calibration-files" title="Link to this heading">#</a></h2>
<p>Next, you’ll want to create your master backgrounds and flats. This can be accomplished in one command using <code class="docutils literal notranslate"><span class="pre">dpp</span> <span class="pre">calib</span></code>.</p>
<p>If you use the prescribed folder structure above, creating your files can be done like so</p>
<aside class="margin sidebar">
<p class="sidebar-title">🚀 MP enabled</p>
<p>‎</p>
</aside>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dpp</span> <span class="n">calib</span> <span class="p">[</span><span class="o">-</span><span class="n">j</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span><span class="n">o</span> <span class="n">master_cals</span> <span class="n">back</span> <span class="n">darks</span><span class="o">/**/*.</span><span class="n">fits</span>
<span class="n">dpp</span> <span class="n">calib</span> <span class="p">[</span><span class="o">-</span><span class="n">j</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span><span class="n">o</span> <span class="n">master_cals</span> <span class="n">flat</span> <span class="n">flats</span><span class="o">/**/*.</span><span class="n">fits</span>
</pre></div>
</div>
<p>This will produce a series of calibration files in the <code class="docutils literal notranslate"><span class="pre">master_cals/</span></code> folder. We do not combine individual flat or dark frames- instead we match each science file to the closest matching available calibration file.</p>
</section>
<section id="set-up-configuration-files">
<h2><a class="toc-backref" href="#id5" role="doc-backlink">Set up configuration files</a><a class="headerlink" href="#set-up-configuration-files" title="Link to this heading">#</a></h2>
<p>After your data has been downloaded and sorted, you’ll want to create configuration files for the data you want to process. To get started quickly, we provide templates for common observing scenarios that can be produced interactively with <code class="docutils literal notranslate"><span class="pre">dpp</span> <span class="pre">new</span></code>. In the example below, we are creating a PDI template with the 55 mas Lyot coronagraph.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dpp</span> <span class="n">new</span> <span class="mi">20230101</span><span class="n">_ABAur</span><span class="o">.</span><span class="n">toml</span>
</pre></div>
</div>
<p>At this point, we highly recommend viewing the <a class="reference internal" href="configuration.html#configuration"><span class="std std-ref">configuration options</span></a> and making adjustments to your TOML file for your object and observation. The processing pipeline is not a panacea- the defaults in the templates are best guesses in ideal situations.</p>
</section>
<section id="prepare-image-centroids-estimates">
<h2><a class="toc-backref" href="#id6" role="doc-backlink">Prepare image centroids estimates</a><a class="headerlink" href="#prepare-image-centroids-estimates" title="Link to this heading">#</a></h2>
<p>To allow efficient data analysis we only measure the PSF centroid and statistics in a window around an initial guess of the PSF centroid. Due to the complexity of input data types and observing scenarios we cannot easily prescribe an automated centroiding scheme. We provide tools for quick-looking data and getting precise guesses so that analysis is much more likely to succeed.</p>
<div class="note admonition">
<p class="admonition-title">Do I need to run centroid?</p>
<p>We recommend running the centroid step as it greatly reduces the chances for errors in image registration. In addition, for coronagraphic data you <em>must</em> run the centroid step to specify which satellite spots to use for analysis. The centroid step is not <em>strictly</em> required for non-coronagraphic data, though- if you do not provide it the center of the frame will be used as the starting estimate, and your analysis window size can be made larger to accommadate misalignment. Nonetheless, we highly recommend this step.</p>
</div>
<section id="automated-mode">
<h3>Automated mode<a class="headerlink" href="#automated-mode" title="Link to this heading">#</a></h3>
<p>If the terminal you are connected to has working graphics (i.e., X-forwarding for SSH connections, not inside a tmux sesssion) and you have a copy of matplotlib installed you can run</p>
<aside class="margin sidebar">
<p class="sidebar-title">🚀 MP enabled</p>
<p>‎</p>
</aside>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dpp</span> <span class="n">centroid</span> <span class="p">[</span><span class="o">-</span><span class="n">j</span> <span class="mi">1</span><span class="p">]</span> <span class="mi">20230101</span><span class="n">_ABAur</span><span class="o">.</span><span class="n">toml</span> <span class="mi">750</span><span class="o">-</span><span class="mi">50</span><span class="n">_em300_00100ms_512x512</span><span class="o">/*.</span><span class="n">fits</span>
</pre></div>
</div>
<p><strong>Coronagraphic</strong></p>
<a class="reference internal image-reference" href="_images/dpp_centroid_coro.png"><img alt="_images/dpp_centroid_coro.png" src="_images/dpp_centroid_coro.png" style="width: 80%;" />
</a>
<p><strong>Non-coronagraphic/Binaries</strong></p>
<a class="reference internal image-reference" href="_images/dpp_centroid_binary.png"><img alt="_images/dpp_centroid_binary.png" src="_images/dpp_centroid_binary.png" style="width: 80%;" />
</a>
<p><strong>Planets</strong></p>
<a class="reference internal image-reference" href="_images/dpp_centroid_planet.png"><img alt="_images/dpp_centroid_planet.png" src="_images/dpp_centroid_planet.png" style="width: 80%;" />
</a>
</section>
<section id="manual-mode">
<h3>Manual mode<a class="headerlink" href="#manual-mode" title="Link to this heading">#</a></h3>
<p>If you do not have a graphics-ready terminal, or you want to skip the interactive process and use your own methods, we provide a manual method for entering centroids. You will be prompted for the centroid of each PSF- enter the centroid as an <code class="docutils literal notranslate"><span class="pre">x,</span> <span class="pre">y</span></code> comma-separated tuple.</p>
<div class="tip admonition">
<p class="admonition-title">Pro-tip: DS9</p>
<p>If previewing data with DS9, you can copy the x, y coordinates directly after subtracting 1 (because python starts indexing at 0). This allows you to use region centroids or the cross for assistance with manual entry.</p>
</div>
</section>
</section>
<section id="running-the-pipeline">
<h2><a class="toc-backref" href="#id7" role="doc-backlink">Running the pipeline</a><a class="headerlink" href="#running-the-pipeline" title="Link to this heading">#</a></h2>
<p>After you’ve selected your configuration options, you can run the pipeline from the command line with <code class="docutils literal notranslate"><span class="pre">dpp</span> <span class="pre">run</span></code></p>
<aside class="margin sidebar">
<p class="sidebar-title">🚀 MP enabled</p>
<p>‎</p>
</aside>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dpp</span> <span class="n">run</span> <span class="p">[</span><span class="o">-</span><span class="n">j</span> <span class="mi">1</span><span class="p">]</span> <span class="mi">20230101</span><span class="n">_ABAur</span><span class="o">.</span><span class="n">toml</span> <span class="mi">750</span><span class="o">-</span><span class="mi">50</span><span class="n">_em300_00010ms_512x512</span><span class="o">/*</span>
</pre></div>
</div>
<div class="warning admonition">
<p class="admonition-title">Warning: multiprocessing with large data</p>
<p>If the individual data cubes are very large data, you need to avoid multi-processing or you are at risk of running out of memory. This can happen with high framerate MBI data, in particular (e.g. 25 GB uncompressed). Make sure you use the <code class="docutils literal notranslate"><span class="pre">-j</span></code> flag to limit processes to avoid running out of memory</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>dpp run -j1 20230101_ABAur.toml 750-50_em300_00010ms_512x512/*
</pre></div>
</div>
</div>
<div class="tip admonition">
<p class="admonition-title">Troubleshooting: debug log</p>
<p>As a first course of action, if you run into errors running the pipeline check the <code class="docutils literal notranslate"><span class="pre">debug.log</span></code> file for more granular and verbose logging.</p>
</div>
<section id="processing-steps">
<h3>Processing steps<a class="headerlink" href="#processing-steps" title="Link to this heading">#</a></h3>
<p>The pipeline will reduce the data in the following order</p>
<ol class="arabic simple">
<li><p>Calibration</p>
<ul class="simple">
<li><p>(Optional) background/dark-subtraction, flat-fielding, bad-pixel correction</p></li>
<li><p>Flip cam 1 data</p></li>
<li><p>Precise coordinate lookup and normalization of FITS headers</p></li>
</ul>
</li>
<li><p>Frame combination</p>
<ul class="simple">
<li><p>Used to collect frames from multiple data files for e.g., polarimetry</p></li>
</ul>
</li>
<li><p>Frame analysis</p>
<ul class="simple">
<li><p>Measure image statistics, centroids, and photometry in windows around the PSF(s)</p></li>
<li><p>Measures a few full-frame statistics.</p></li>
</ul>
</li>
<li><p>(Optional) frame selection</p>
<ul class="simple">
<li><p>If desired and there are more than one frame per cube you can discard a quantile of the frames based on a selectable metric</p></li>
</ul>
</li>
<li><p>(Optional) image registration</p>
<ul class="simple">
<li><p>If desired the frames will be co-aligned and centered with a selectable metric</p></li>
</ul>
</li>
<li><p>(Optional) Spectrophotometric calibration</p>
<ul class="simple">
<li><p>Calibrate data with a spectrum or stellar model using a selectable metric for the estimated image flux</p></li>
</ul>
</li>
<li><p>(Optional) Coadd data cubes</p>
<ul class="simple">
<li><p>Combine frames using median, mean, etc</p></li>
<li><p>After combining, another round of registration can be enabled to recenter with the higher S/N combined image</p></li>
</ul>
</li>
<li><p>(Optional) Create ADI cubes</p>
<ul class="simple">
<li><p>Concatenate cam1, cam2, and cam1+cam2 collapsed data into cubes along with the derotation angles for ADI analysis</p></li>
</ul>
</li>
<li><p>(Optional) Create difference images</p>
<ul class="simple">
<li><p>Create single- or double-difference images for diagnostic analysis</p></li>
</ul>
</li>
<li><p>(Optional) polarimetric differential imaging</p>
<ul class="simple">
<li><p>Perform double- or triple-differential analysis</p></li>
<li><p>(Optional) Mueller-matrix correction and instrumental polarization removal</p></li>
</ul>
</li>
</ol>
</section>
<section id="polarimetric-differential-imaging">
<h3>Polarimetric differential imaging<a class="headerlink" href="#polarimetric-differential-imaging" title="Link to this heading">#</a></h3>
<p>If you have polarimetry enabled in your configuration, it will run automatically with <code class="docutils literal notranslate"><span class="pre">dpp</span> <span class="pre">run</span></code>, but if you want to rerun the polarimetric analysis <em>only</em>, you can use</p>
<aside class="margin sidebar">
<p class="sidebar-title">🚀 MP enabled</p>
<p>‎</p>
</aside>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dpp</span> <span class="n">pdi</span> <span class="p">[</span><span class="o">-</span><span class="n">j</span> <span class="mi">1</span><span class="p">]</span> <span class="mi">20230101</span><span class="n">_ABAur</span><span class="o">.</span><span class="n">toml</span> <span class="mi">750</span><span class="o">-</span><span class="mi">50</span><span class="n">_em300_00010ms_512x512</span><span class="o">/*</span>
</pre></div>
</div>
</section>
<section id="pipeline-outputs">
<h3>Pipeline outputs<a class="headerlink" href="#pipeline-outputs" title="Link to this heading">#</a></h3>
<p>The pipeline will save data in a strict folder format (some folders will be missing/empty if they are not specified in the configuration)–</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>.
├── aux # auxilliary processing configs and data
├── calibrated # calibrated data
├── metrics # NPZ file with metrics for each frame for each file
├── aligned # aligned data
├── coadded # coadded data
├── selected # frame-selected data
├── diff # diagnostic difference images
│   ├── single
│   └── double
├── products # output table
│   └── adi # ADI cubes and angles
└── pdi # PDI outputs
    ├── mm # mueller-matrices
    └── stokes # stokes frames
</pre></div>
</div>
<p>If you want to experiment with pipeline options, we recommended renaming folders (e.g. <code class="docutils literal notranslate"><span class="pre">collapsed_dft</span></code>) so that you retain a backup while allowing the pipeline to naturally reprocess the data (see <a class="reference internal" href="#rerunning"><span class="std std-ref">Re-running the pipeline</span></a>, below).</p>
</section>
</section>
<section id="re-running-the-pipeline">
<span id="rerunning"></span><h2><a class="toc-backref" href="#id8" role="doc-backlink">Re-running the pipeline</a><a class="headerlink" href="#re-running-the-pipeline" title="Link to this heading">#</a></h2>
<p>The pipeline is written to use saved, cached data as much as possible to save time. This means, for example, re-running the PDI steps will use the already saved collapsed frames as inputs. Re-running the pipeline, then, will only process files which are missing or which have newer input files. To explain, this means if you delete a collapsed file, for example, and re-run the pipeline, the collapsed data will be reprocessed using the saved metrics (and calibrated data, if saved). Or, in the latter case, if I delete a metric file, the corresponding collapsed file (which depends on the metric file) will be reprocessed.</p>
<p>This behavior can be controlled in two ways- the first is manual management of data by deleting or moving files. To reprocess all the file metrics (becuase you changed an analysis parameter, for example) you can just delete <code class="docutils literal notranslate"><span class="pre">metrics/</span></code> (or change its name). The second is through the command line, using the <code class="docutils literal notranslate"><span class="pre">-f</span></code>/<code class="docutils literal notranslate"><span class="pre">--force</span></code> flag. With this flag you will be prompted on which pipeline steps to force reprocessing. For example, if I change my centroid and recentering algorithms, I can generate new collapsed frames with</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dpp</span> <span class="n">run</span> <span class="mi">20230101</span><span class="n">_ABAur</span><span class="o">.</span><span class="n">toml</span> <span class="mi">750</span><span class="o">-</span><span class="mi">50</span><span class="n">_em300_00010ms_512x512</span><span class="o">/*</span> <span class="o">--</span><span class="n">force</span>
<span class="n">TODO</span>
</pre></div>
</div>
</section>
</section>


                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="introduction.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Introduction</p>
      </div>
    </a>
    <a class="right-next"
       href="configuration.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Configuration</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sorting-raw-data">Sorting raw data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#normalizing-data">Normalizing data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#cmos-format">CMOS format</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#emccd-formats">EMCCD formats</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quick-look-and-filter">Quick look and filter</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-calibration-files">Create calibration files</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#set-up-configuration-files">Set up configuration files</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#prepare-image-centroids-estimates">Prepare image centroids estimates</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#automated-mode">Automated mode</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#manual-mode">Manual mode</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#running-the-pipeline">Running the pipeline</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#processing-steps">Processing steps</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#polarimetric-differential-imaging">Polarimetric differential imaging</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#pipeline-outputs">Pipeline outputs</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#re-running-the-pipeline">Re-running the pipeline</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Miles Lucas
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2022, 2023, 2024, 2025, Miles Lucas.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>